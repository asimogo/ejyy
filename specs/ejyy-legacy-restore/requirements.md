# ejyy-legacy-restore 项目需求规划

## 项目概述

本项目旨在全面恢复「e家宜业」智慧物业管理系统的完整功能，确保四个核心模块（后端API服务器、Web管理控制台、业主小程序、物业管理小程序）能够正常运行并协同工作。

## 用户故事与需求

### 1. 系统环境恢复需求

#### 1.1 配置文件完整性
- **作为** 系统部署人员
- **我需要** 拥有完整的配置文件模板
- **以便** 系统可以正确连接数据库、Redis、微信服务等第三方组件

**验收标准 (EARS)**:
- WHEN 系统启动时, 系统 SHALL 能够读取 .ejyyrc 配置文件
- WHEN 配置文件缺失时, 系统 SHALL 提供详细的配置模板和说明
- WHEN 配置项不完整时, 系统 SHALL 给出明确的错误提示

#### 1.2 数据库结构完整性  
- **作为** 系统管理员
- **我需要** 完整的数据库结构
- **以便** 系统能够正常存储和检索业务数据

**验收标准 (EARS)**:
- WHEN 执行数据库初始化时, 系统 SHALL 成功创建所有必需的表结构
- WHEN 数据表存在时, 系统 SHALL 能够正常执行CRUD操作
- WHEN 数据库连接失败时, 系统 SHALL 提供清晰的错误信息

### 2. 后端API服务器恢复需求

#### 2.1 核心服务启动
- **作为** 系统运维人员
- **我需要** 后端服务能够稳定启动
- **以便** 为前端应用提供API接口服务

**验收标准 (EARS)**:
- WHEN 执行 npm run dev 时, 后端服务 SHALL 在指定端口成功启动
- WHEN 服务启动后, 系统 SHALL 能够响应健康检查请求
- WHEN 依赖服务不可用时, 系统 SHALL 记录错误日志并优雅退出

#### 2.2 API接口完整性
- **作为** 前端开发者  
- **我需要** 所有API接口都能正常工作
- **以便** 前端应用能够获取和提交数据

**验收标准 (EARS)**:
- WHEN 调用任一API接口时, 系统 SHALL 返回正确的HTTP状态码
- WHEN API返回数据时, 响应格式 SHALL 符合预期的JSON结构
- WHEN API处理失败时, 系统 SHALL 返回标准化的错误信息

#### 2.3 微信集成服务
- **作为** 小程序用户
- **我需要** 微信相关功能正常工作
- **以便** 能够使用小程序的完整功能

**验收标准 (EARS)**:
- WHEN 小程序调用登录接口时, 系统 SHALL 能够验证微信授权
- WHEN 进行微信支付时, 系统 SHALL 能够正确处理支付回调
- WHEN 发送微信消息时, 系统 SHALL 能够成功推送通知

### 3. Web管理控制台恢复需求

#### 3.1 前端应用构建
- **作为** 管理员用户
- **我需要** Web控制台能够正常访问
- **以便** 进行系统管理和业务操作

**验收标准 (EARS)**:
- WHEN 执行 npm run dev 时, 前端开发服务器 SHALL 成功启动
- WHEN 执行 npm run dist 时, 系统 SHALL 生成可部署的静态文件
- WHEN 访问Web应用时, 页面 SHALL 正常显示且功能可用

#### 3.2 功能模块完整性
- **作为** 物业管理员
- **我需要** 所有管理功能都能正常使用
- **以便** 完成日常的物业管理工作

**验收标准 (EARS)**:
- WHEN 访问任一功能模块时, 界面 SHALL 正常加载
- WHEN 提交表单数据时, 系统 SHALL 能够正确保存并反馈结果
- WHEN 查询数据时, 系统 SHALL 返回准确且完整的信息

### 4. 小程序应用恢复需求

#### 4.1 业主小程序功能
- **作为** 社区业主
- **我需要** 小程序的所有功能都能正常使用
- **以便** 享受便捷的物业服务

**验收标准 (EARS)**:
- WHEN 打开小程序时, 系统 SHALL 能够正常加载首页
- WHEN 使用各项服务时, 功能 SHALL 能够正常执行
- WHEN 进行支付操作时, 系统 SHALL 能够完成支付流程

#### 4.2 物业管理小程序功能
- **作为** 物业工作人员
- **我需要** 管理小程序的功能完整可用
- **以便** 高效处理业主的服务请求

**验收标准 (EARS)**:
- WHEN 登录小程序时, 系统 SHALL 验证工作人员身份
- WHEN 处理工单时, 系统 SHALL 能够更新工单状态
- WHEN 查看统计数据时, 系统 SHALL 显示实时准确的信息

### 5. 系统集成与测试需求

#### 5.1 模块间协作
- **作为** 系统用户
- **我需要** 各个模块之间能够正常通信
- **以便** 获得完整的系统体验

**验收标准 (EARS)**:
- WHEN 在任一端进行操作时, 其他相关模块 SHALL 能够同步更新
- WHEN 系统负载较高时, 各模块 SHALL 保持稳定运行
- WHEN 出现异常时, 系统 SHALL 能够自动恢复或提供明确的错误提示

#### 5.2 数据一致性
- **作为** 数据管理员
- **我需要** 确保系统数据的完整性和一致性
- **以便** 维护系统的可靠性

**验收标准 (EARS)**:
- WHEN 数据发生变更时, 系统 SHALL 确保相关数据同步更新
- WHEN 并发操作时, 系统 SHALL 保持数据一致性
- WHEN 系统异常中断时, 已提交的数据 SHALL 保持完整性

## 功能范围

### 包含的功能模块
1. **用户认证与权限管理**: 多角色用户体系、微信登录集成
2. **社区管理**: 社区信息、楼宇房间管理
3. **服务请求**: 报修、投诉、装修申请等业务流程
4. **费用管理**: 各类费用收取、账单生成、支付集成
5. **访客管理**: 访客预约、通行证生成
6. **设备集成**: IoT设备控制和监控
7. **工作流引擎**: 审批流程自动化
8. **统计分析**: 业务数据统计和报表生成

### 不包含的功能
1. **新功能开发**: 不添加原系统没有的功能
2. **UI/UX重构**: 保持原有界面风格和交互方式
3. **技术栈升级**: 除非必要，不升级现有技术栈版本
4. **性能优化**: 除非影响基本功能，不进行性能调优

## 技术约束

### 必须遵守的约束
1. **保持技术栈版本**: Node.js 12.x, Vue.js 2.x, 微信小程序原生
2. **保持数据库结构**: 除必要修复外，不改变现有表结构
3. **保持API契约**: 确保接口的向后兼容性
4. **保持版权信息**: 维护「e家宜业」和「卓佤科技」的版权声明

### 可接受的变更
1. **依赖包安全更新**: 修复已知安全漏洞的最小版本升级
2. **配置优化**: 改善配置文件的可读性和可维护性  
3. **错误修复**: 修复影响功能正常使用的bug
4. **文档完善**: 补充必要的部署和使用文档

## 验收标准

### 基本功能验收
1. 所有四个应用模块能够独立启动运行
2. 模块间的API调用正常响应
3. 数据库操作无错误
4. 微信集成功能正常工作

### 业务流程验收  
1. 用户注册登录流程完整
2. 核心业务流程（报修、缴费等）能够走通
3. 数据在各端保持同步一致
4. 支付功能能够正常完成

### 部署验收
1. 提供完整的部署文档和配置模板
2. 在全新环境中能够成功部署
3. 系统能够稳定运行24小时以上
4. 日志记录完整，便于问题排查

## 风险评估

### 高风险项
1. **配置文件缺失**: 缺少 .ejyyrc 等关键配置文件
2. **第三方服务依赖**: 微信、阿里云等服务的配置和证书
3. **数据库依赖**: MySQL版本兼容性和数据导入

### 中风险项  
1. **依赖包版本冲突**: 某些npm包可能存在版本兼容问题
2. **前端构建工具**: Vue CLI和webpack配置可能需要调整
3. **小程序审核**: 微信小程序可能需要重新审核发布

### 低风险项
1. **代码格式**: 某些代码格式可能需要统一
2. **注释和文档**: 部分代码缺少必要注释
3. **日志输出**: 日志级别和内容可能需要优化